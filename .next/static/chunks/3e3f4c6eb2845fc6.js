(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,72161,e=>{"use strict";class t extends Error{status;data;constructor(e,t,a=null){super(e),this.name="ApiError",this.status=t,this.data=a}}async function a(e,s={}){let{method:l="GET",params:r,body:d,headers:i,signal:o}=s,n=function(e,t){let a=e.startsWith("http")?e:`http://localhost:8080/api${e}`;if(!t)return a;let s=new URL(a);return Object.entries(t).forEach(([e,t])=>{null!=t&&s.searchParams.append(e,String(t))}),s.toString()}(e,r),c={"Content-Type":"application/json",...i};try{let e=window.localStorage.getItem("authToken");e&&!c.Authorization&&(c={...c,Authorization:`Bearer ${e}`})}catch{}let m={method:l,headers:c,signal:o};if(null!=d&&"GET"!==l)if(d instanceof FormData){let{"Content-Type":e,...t}=c;m.headers=c=t,m.body=d}else m.body=JSON.stringify(d);let x=await fetch(n,m),h=await x.text(),u=null;if(h)try{u=JSON.parse(h)}catch{u=h}if(!x.ok)throw new t(x.statusText||"Request failed",x.status,u);return u}function s(e,t){return a(e,{...t,method:"GET"})}function l(e,t,s){return a(e,{...s,method:"POST",body:t})}e.s(["ApiError",()=>t,"get",()=>s,"post",()=>l])},82407,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(22016),l=e.i(72161);let r=[{date:"2024-01-02",produced:145,sold:118,expenses:23e3,payroll:9e3,machineUsage:15},{date:"2024-01-08",produced:162,sold:134,expenses:25e3,payroll:9800,machineUsage:18},{date:"2024-01-15",produced:178,sold:150,expenses:26800,payroll:10100,machineUsage:20},{date:"2024-01-22",produced:185,sold:160,expenses:27600,payroll:10200,machineUsage:22},{date:"2024-01-29",produced:191,sold:168,expenses:28300,payroll:10400,machineUsage:21},{date:"2024-02-05",produced:205,sold:180,expenses:29500,payroll:10700,machineUsage:23},{date:"2024-02-12",produced:212,sold:186,expenses:30200,payroll:10800,machineUsage:24},{date:"2024-02-19",produced:225,sold:194,expenses:31400,payroll:11e3,machineUsage:25}];new Intl.DateTimeFormat("uz-UZ",{day:"2-digit",month:"short"});let d=new Intl.DateTimeFormat("uz-UZ",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"});new Intl.NumberFormat("ru-RU");let i=new Intl.NumberFormat("ru-RU",{style:"currency",currency:"USD",maximumFractionDigits:0}),o=[{label:"7 kun",days:7},{label:"14 kun",days:14},{label:"30 kun",days:30}],n=new Date,c=n.getFullYear(),m=`${c}-01-01`,x=n.toISOString().slice(0,10);function h(){let[e,n]=(0,a.useState)({dateFrom:m,dateTo:x}),[c,h]=(0,a.useState)([]),[u,p]=(0,a.useState)(null),[b,g]=(0,a.useState)(!1),[y,f]=(0,a.useState)([]),[j,N]=(0,a.useState)(null),[v,w]=(0,a.useState)([]),[T,F]=(0,a.useState)(null),S=t=>{let a=new Date(t).getTime(),s=e.dateFrom?new Date(e.dateFrom).getTime():void 0,l=e.dateTo?new Date(e.dateTo).getTime():void 0;return("number"!=typeof s||a>=s)&&("number"!=typeof l||a<=l)};(0,a.useEffect)(()=>{let t=!1;return(async()=>{p(null),N(null),F(null);try{g(!0);let[a,s,r]=await Promise.all([(0,l.get)("/production/batches",{params:{dateFrom:e.dateFrom||void 0,dateTo:e.dateTo||void 0}}),(0,l.get)("/expenses",{params:{dateFrom:e.dateFrom||void 0,dateTo:e.dateTo||void 0}}),(0,l.get)("/vehicles/logs",{params:{dateFrom:e.dateFrom||void 0,dateTo:e.dateTo||void 0}})]);if(t)return;let d=[...Array.isArray(a)?a:a.items??[]].sort((e,t)=>{let a=new Date(e.producedAt).getTime(),s=new Date(t.producedAt).getTime();return a===s?String(t.batchId).localeCompare(String(e.batchId)):s-a});h(d.slice(0,4));let i=Array.isArray(s)?s:s.items??[];f(i);let o=Array.isArray(r)?r:r.items??[];w(o)}catch(e){if(t)return;e instanceof l.ApiError?p(e.data&&e.data.message||e.message||"Dashboard ma'lumotlarini yuklashda xatolik yuz berdi"):p("Dashboard ma'lumotlarini yuklashda xatolik yuz berdi. Iltimos, qayta urinib ko'ring.")}finally{t||g(!1)}})(),()=>{t=!0}},[e.dateFrom,e.dateTo]);let D=(0,a.useMemo)(()=>{let e=new Map;for(let t of y){let a=e.get(t.category)||0;e.set(t.category,a+t.amount)}return Array.from(e.entries()).map(([e,t])=>({category:e,total:t})).sort((e,t)=>t.total-e.total).slice(0,4)},[y]),A=(0,a.useMemo)(()=>r.filter(e=>S(e.date)),[e.dateFrom,e.dateTo]),I=(0,a.useMemo)(()=>v.filter(e=>{let t=e.entryAt||e.exitAt;return!!t&&S(t)}),[v,e.dateFrom,e.dateTo]);return(0,a.useMemo)(()=>A.reduce((e,t)=>(e.produced+=t.produced,e.sold+=t.sold,e.expenses+=t.expenses,e.payroll+=t.payroll,e.machine+=t.machineUsage,e),{produced:0,sold:0,expenses:0,payroll:0,machine:0}),[A]),(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-semibold text-slate-900",children:"Boshliq (Owner) Dashboard"}),(0,t.jsx)("p",{className:"text-sm text-slate-500 mt-1",children:"Mahsulot, rasxod va texnika holati bo'yicha jonli nazorat"})]}),(0,t.jsxs)("div",{className:"bg-white rounded-2xl p-6 card-shadow-lg border border-slate-100 space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-slate-900 mb-2",children:"Davr boshi"}),(0,t.jsx)("input",{type:"date",value:e.dateFrom,onChange:e=>n(t=>({...t,dateFrom:e.target.value})),className:"w-full px-4 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#2563EB]"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-slate-900 mb-2",children:"Davr oxiri"}),(0,t.jsx)("input",{type:"date",value:e.dateTo,onChange:e=>n(t=>({...t,dateTo:e.target.value})),className:"w-full px-4 py-2 border border-[#E2E8F0] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#2563EB]"})]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[o.map(e=>(0,t.jsxs)("button",{onClick:()=>{var t;let a,s;return t=e.days,void((s=new Date(a=new Date)).setDate(s.getDate()-(t-1)),n(e=>({...e,dateFrom:s.toISOString().slice(0,10),dateTo:a.toISOString().slice(0,10)})))},className:"px-4 py-2 border border-slate-200 text-sm text-[#2563EB] rounded-full bg-slate-50 hover:bg-[#EFF6FF]",children:[e.label," so'nggi"]},e.label)),(0,t.jsx)("button",{type:"button",onClick:()=>n({dateFrom:"",dateTo:""}),className:"px-4 py-2 border border-slate-200 text-sm text-slate-700 rounded-full bg-white hover:bg-slate-50",children:"Filtrlarni tozalash"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{className:"xl:col-span-2 bg-white rounded-2xl p-6 card-shadow-lg border border-slate-100",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Oxirgi batchlar"}),(0,t.jsx)("span",{className:"text-sm text-slate-500",children:"So'nggi 4 ta partiya"})]}),u&&(0,t.jsx)("p",{className:"mb-4 text-sm text-red-600",children:u}),(0,t.jsxs)("div",{className:"space-y-4",children:[c.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between border border-slate-200 rounded-2xl p-4 hover:bg-slate-50 transition-colors",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"font-semibold text-slate-900",children:[e.batchId," · ",e.product]}),(0,t.jsxs)("p",{className:"text-sm text-slate-500",children:[(e=>{switch(e){case"DAY":return"Kunduzgi smena";case"NIGHT":return"Kechgi smena";case"MORNING":return"Tonggi smena";default:return e}})(e.shift)," · ",e.line," · ",d.format(new Date(e.producedAt))]})]}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsxs)("p",{className:"text-xl font-semibold text-slate-900",children:[e.quantity," ",e.unit]})})]},e.batchId)),!b&&0===c.length&&!u&&(0,t.jsx)("p",{className:"text-sm text-slate-400",children:"Tanlangan davr uchun batchlar topilmadi"})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-2xl p-6 card-shadow-lg border border-slate-100",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Rasxodlar bo'yicha signal"}),j&&(0,t.jsx)("p",{className:"mb-2 text-sm text-red-600",children:j}),(0,t.jsxs)("div",{className:"space-y-4",children:[D.map(e=>(0,t.jsxs)("div",{className:"border border-slate-200 rounded-xl p-4 hover:bg-slate-50 transition-colors",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-1",children:(0,t.jsx)("p",{className:"font-semibold text-slate-900",children:e.category})}),(0,t.jsx)("p",{className:"text-sm text-slate-400 mb-2",children:"Kategoriya bo'yicha umumiy sarf"}),(0,t.jsx)("p",{className:"text-lg font-semibold text-slate-900",children:i.format(e.total)})]},e.category)),0===D.length&&!j&&(0,t.jsx)("p",{className:"text-sm text-slate-400",children:"Tanlangan davr uchun rasxodlar topilmadi"})]})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-2xl p-6 card-shadow-lg border border-slate-100",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Kelib chiqayotgan mashinalar"}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("span",{className:"text-sm text-slate-500",children:e.dateFrom||e.dateTo?"Filtrlash natijalari":"Oxirgi 5 ta yozuv"}),(0,t.jsx)(s.default,{href:"/owner-dashboard/driver-fuel",className:"text-sm text-[#2563EB] hover:underline",children:"Haydovchi yoqilg'i sarfi"})]})]}),T&&(0,t.jsx)("p",{className:"mb-4 text-sm text-red-600",children:T}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"border-b border-slate-200",children:[(0,t.jsx)("th",{className:"text-left px-4 py-3 font-semibold text-slate-700",children:"Mashina"}),(0,t.jsx)("th",{className:"text-left px-4 py-3 font-semibold text-slate-700",children:"Yo'nalish"}),(0,t.jsx)("th",{className:"text-left px-4 py-3 font-semibold text-slate-700",children:"Maqsad"}),(0,t.jsx)("th",{className:"text-left px-4 py-3 font-semibold text-slate-700",children:"Haydovchi"}),(0,t.jsx)("th",{className:"text-left px-4 py-3 font-semibold text-slate-700",children:"Vaqt"})]})}),(0,t.jsx)("tbody",{children:I.length>0?I.map(e=>{let a=e.entryAt||e.exitAt;return(0,t.jsxs)("tr",{className:"border-b border-slate-100 hover:bg-slate-50",children:[(0,t.jsx)("td",{className:"px-4 py-3 font-medium text-slate-900",children:e.vehicleIdCode}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${"Kirdi"===e.direction?"bg-blue-50 text-blue-700":"bg-rose-50 text-rose-700"}`,children:e.direction})}),(0,t.jsx)("td",{className:"px-4 py-3 text-slate-500",children:e.material}),(0,t.jsx)("td",{className:"px-4 py-3 text-slate-900",children:e.driver}),(0,t.jsx)("td",{className:"px-4 py-3 text-slate-500",children:a?d.format(new Date(a)):"-"})]},`${e.vehicleIdCode}-${a}`)}):(0,t.jsx)("tr",{children:(0,t.jsx)("td",{className:"px-4 py-6 text-center text-slate-400",colSpan:5,children:"Tanlangan vaqt oralig'ida ma'lumot yo'q"})})})]})})]})]})}e.s(["default",()=>h])}]);