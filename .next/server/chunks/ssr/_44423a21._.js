module.exports=[19941,a=>{"use strict";class b extends Error{status;data;constructor(a,b,c=null){super(a),this.name="ApiError",this.status=b,this.data=c}}async function c(a,d={}){let{method:e="GET",params:f,body:g,headers:h,signal:i}=d,j=function(a,b){let c=a.startsWith("http")?a:`http://localhost:8080/api${a}`;if(!b)return c;let d=new URL(c);return Object.entries(b).forEach(([a,b])=>{null!=b&&d.searchParams.append(a,String(b))}),d.toString()}(a,f),k={"Content-Type":"application/json",...h},l={method:e,headers:k,signal:i};if(null!=g&&"GET"!==e)if(g instanceof FormData){let{"Content-Type":a,...b}=k;l.headers=k=b,l.body=g}else l.body=JSON.stringify(g);let m=await fetch(j,l),n=await m.text(),o=null;if(n)try{o=JSON.parse(n)}catch{o=n}if(!m.ok)throw new b(m.statusText||"Request failed",m.status,o);return o}function d(a,b){return c(a,{...b,method:"GET"})}function e(a,b,d){return c(a,{...d,method:"POST",body:b})}a.s(["ApiError",()=>b,"get",()=>d,"post",()=>e])},54998,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(38246),e=a.i(19941);let f=[{date:"2024-01-02",produced:145,sold:118,expenses:23e3,payroll:9e3,machineUsage:15},{date:"2024-01-08",produced:162,sold:134,expenses:25e3,payroll:9800,machineUsage:18},{date:"2024-01-15",produced:178,sold:150,expenses:26800,payroll:10100,machineUsage:20},{date:"2024-01-22",produced:185,sold:160,expenses:27600,payroll:10200,machineUsage:22},{date:"2024-01-29",produced:191,sold:168,expenses:28300,payroll:10400,machineUsage:21},{date:"2024-02-05",produced:205,sold:180,expenses:29500,payroll:10700,machineUsage:23},{date:"2024-02-12",produced:212,sold:186,expenses:30200,payroll:10800,machineUsage:24},{date:"2024-02-19",produced:225,sold:194,expenses:31400,payroll:11e3,machineUsage:25}];new Intl.DateTimeFormat("uz-UZ",{day:"2-digit",month:"short"});let g=new Intl.DateTimeFormat("uz-UZ",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"});new Intl.NumberFormat("ru-RU");let h=new Intl.NumberFormat("ru-RU",{style:"currency",currency:"USD",maximumFractionDigits:0}),i=[{label:"7 kun",days:7},{label:"14 kun",days:14},{label:"30 kun",days:30}],j=new Date,k=j.getFullYear(),l=`${k}-01-01`,m=j.toISOString().slice(0,10);function n(){let[a,j]=(0,c.useState)({dateFrom:l,dateTo:m}),[k,n]=(0,c.useState)([]),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)([]),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)([]),[y,z]=(0,c.useState)(null),A=b=>{let c=new Date(b).getTime(),d=a.dateFrom?new Date(a.dateFrom).getTime():void 0,e=a.dateTo?new Date(a.dateTo).getTime():void 0;return("number"!=typeof d||c>=d)&&("number"!=typeof e||c<=e)};(0,c.useEffect)(()=>{let b=!1;return(async()=>{p(null),v(null),z(null);try{r(!0);let[c,d,f]=await Promise.all([(0,e.get)("/production/batches",{params:{dateFrom:a.dateFrom||void 0,dateTo:a.dateTo||void 0}}),(0,e.get)("/expenses",{params:{dateFrom:a.dateFrom||void 0,dateTo:a.dateTo||void 0}}),(0,e.get)("/vehicles/logs",{params:{dateFrom:a.dateFrom||void 0,dateTo:a.dateTo||void 0}})]);if(b)return;let g=[...Array.isArray(c)?c:c.items??[]].sort((a,b)=>{let c=new Date(a.producedAt).getTime(),d=new Date(b.producedAt).getTime();return c===d?String(b.batchId).localeCompare(String(a.batchId)):d-c});n(g.slice(0,4));let h=Array.isArray(d)?d:d.items??[];t(h);let i=Array.isArray(f)?f:f.items??[];x(i)}catch(a){if(b)return;a instanceof e.ApiError?p(a.data&&a.data.message||a.message||"Dashboard ma'lumotlarini yuklashda xatolik yuz berdi"):p("Dashboard ma'lumotlarini yuklashda xatolik yuz berdi. Iltimos, qayta urinib ko'ring.")}finally{b||r(!1)}})(),()=>{b=!0}},[a.dateFrom,a.dateTo]);let B=(0,c.useMemo)(()=>{let a=new Map;for(let b of s){let c=a.get(b.category)||0;a.set(b.category,c+b.amount)}return Array.from(a.entries()).map(([a,b])=>({category:a,total:b})).sort((a,b)=>b.total-a.total).slice(0,4)},[s]),C=(0,c.useMemo)(()=>f.filter(a=>A(a.date)),[a.dateFrom,a.dateTo]),D=(0,c.useMemo)(()=>w.filter(a=>{let b=a.entryAt||a.exitAt;return!!b&&A(b)}),[w,a.dateFrom,a.dateTo]);return(0,c.useMemo)(()=>C.reduce((a,b)=>(a.produced+=b.produced,a.sold+=b.sold,a.expenses+=b.expenses,a.payroll+=b.payroll,a.machine+=b.machineUsage,a),{produced:0,sold:0,expenses:0,payroll:0,machine:0}),[C]),(0,b.jsxs)("div",{className:"space-y-8",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-semibold text-slate-900",children:"Boshliq (Owner) Dashboard"}),(0,b.jsx)("p",{className:"text-sm text-slate-500 mt-1",children:"Mahsulot, rasxod va texnika holati bo'yicha jonli nazorat"})]}),(0,b.jsxs)("div",{className:"bg-white rounded-2xl p-6 card-shadow-lg border border-slate-100 space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-semibold text-slate-900 mb-2",children:"Davr boshi"}),(0,b.jsx)("input",{type:"date",value:a.dateFrom,onChange:a=>j(b=>({...b,dateFrom:a.target.value})),className:"w-full px-4 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#2563EB]"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-semibold text-slate-900 mb-2",children:"Davr oxiri"}),(0,b.jsx)("input",{type:"date",value:a.dateTo,onChange:a=>j(b=>({...b,dateTo:a.target.value})),className:"w-full px-4 py-2 border border-[#E2E8F0] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#2563EB]"})]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[i.map(a=>(0,b.jsxs)("button",{onClick:()=>{var b;let c,d;return b=a.days,void((d=new Date(c=new Date)).setDate(d.getDate()-(b-1)),j(a=>({...a,dateFrom:d.toISOString().slice(0,10),dateTo:c.toISOString().slice(0,10)})))},className:"px-4 py-2 border border-slate-200 text-sm text-[#2563EB] rounded-full bg-slate-50 hover:bg-[#EFF6FF]",children:[a.label," so'nggi"]},a.label)),(0,b.jsx)("button",{type:"button",onClick:()=>j({dateFrom:"",dateTo:""}),className:"px-4 py-2 border border-slate-200 text-sm text-slate-700 rounded-full bg-white hover:bg-slate-50",children:"Filtrlarni tozalash"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[(0,b.jsxs)("div",{className:"xl:col-span-2 bg-white rounded-2xl p-6 card-shadow-lg border border-slate-100",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Oxirgi batchlar"}),(0,b.jsx)("span",{className:"text-sm text-slate-500",children:"So'nggi 4 ta partiya"})]}),o&&(0,b.jsx)("p",{className:"mb-4 text-sm text-red-600",children:o}),(0,b.jsxs)("div",{className:"space-y-4",children:[k.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between border border-slate-200 rounded-2xl p-4 hover:bg-slate-50 transition-colors",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"font-semibold text-slate-900",children:[a.batchId," · ",a.product]}),(0,b.jsxs)("p",{className:"text-sm text-slate-500",children:[(a=>{switch(a){case"DAY":return"Kunduzgi smena";case"NIGHT":return"Kechgi smena";case"MORNING":return"Tonggi smena";default:return a}})(a.shift)," · ",a.line," · ",g.format(new Date(a.producedAt))]})]}),(0,b.jsx)("div",{className:"text-right",children:(0,b.jsxs)("p",{className:"text-xl font-semibold text-slate-900",children:[a.quantity," ",a.unit]})})]},a.batchId)),!q&&0===k.length&&!o&&(0,b.jsx)("p",{className:"text-sm text-slate-400",children:"Tanlangan davr uchun batchlar topilmadi"})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-2xl p-6 card-shadow-lg border border-slate-100",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Rasxodlar bo'yicha signal"}),u&&(0,b.jsx)("p",{className:"mb-2 text-sm text-red-600",children:u}),(0,b.jsxs)("div",{className:"space-y-4",children:[B.map(a=>(0,b.jsxs)("div",{className:"border border-slate-200 rounded-xl p-4 hover:bg-slate-50 transition-colors",children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-1",children:(0,b.jsx)("p",{className:"font-semibold text-slate-900",children:a.category})}),(0,b.jsx)("p",{className:"text-sm text-slate-400 mb-2",children:"Kategoriya bo'yicha umumiy sarf"}),(0,b.jsx)("p",{className:"text-lg font-semibold text-slate-900",children:h.format(a.total)})]},a.category)),0===B.length&&!u&&(0,b.jsx)("p",{className:"text-sm text-slate-400",children:"Tanlangan davr uchun rasxodlar topilmadi"})]})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-2xl p-6 card-shadow-lg border border-slate-100",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Kelib chiqayotgan mashinalar"}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("span",{className:"text-sm text-slate-500",children:a.dateFrom||a.dateTo?"Filtrlash natijalari":"Oxirgi 5 ta yozuv"}),(0,b.jsx)(d.default,{href:"/owner-dashboard/driver-fuel",className:"text-sm text-[#2563EB] hover:underline",children:"Haydovchi yoqilg'i sarfi"})]})]}),y&&(0,b.jsx)("p",{className:"mb-4 text-sm text-red-600",children:y}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b border-slate-200",children:[(0,b.jsx)("th",{className:"text-left px-4 py-3 font-semibold text-slate-700",children:"Mashina"}),(0,b.jsx)("th",{className:"text-left px-4 py-3 font-semibold text-slate-700",children:"Yo'nalish"}),(0,b.jsx)("th",{className:"text-left px-4 py-3 font-semibold text-slate-700",children:"Maqsad"}),(0,b.jsx)("th",{className:"text-left px-4 py-3 font-semibold text-slate-700",children:"Haydovchi"}),(0,b.jsx)("th",{className:"text-left px-4 py-3 font-semibold text-slate-700",children:"Vaqt"})]})}),(0,b.jsx)("tbody",{children:D.length>0?D.map(a=>{let c=a.entryAt||a.exitAt;return(0,b.jsxs)("tr",{className:"border-b border-slate-100 hover:bg-slate-50",children:[(0,b.jsx)("td",{className:"px-4 py-3 font-medium text-slate-900",children:a.vehicleIdCode}),(0,b.jsx)("td",{className:"px-4 py-3",children:(0,b.jsx)("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${"Kirdi"===a.direction?"bg-blue-50 text-blue-700":"bg-rose-50 text-rose-700"}`,children:a.direction})}),(0,b.jsx)("td",{className:"px-4 py-3 text-slate-500",children:a.material}),(0,b.jsx)("td",{className:"px-4 py-3 text-slate-900",children:a.driver}),(0,b.jsx)("td",{className:"px-4 py-3 text-slate-500",children:c?g.format(new Date(c)):"-"})]},`${a.vehicleIdCode}-${c}`)}):(0,b.jsx)("tr",{children:(0,b.jsx)("td",{className:"px-4 py-6 text-center text-slate-400",colSpan:5,children:"Tanlangan vaqt oralig'ida ma'lumot yo'q"})})})]})})]})]})}a.s(["default",()=>n])}];

//# sourceMappingURL=_44423a21._.js.map