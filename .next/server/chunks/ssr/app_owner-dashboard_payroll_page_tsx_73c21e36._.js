module.exports=[8205,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(15292),e=a.i(44499),f=a.i(4700),g=a.i(19941);function h(a){let b=a.id??a.payrollId??"",c=a.employee??a.employeeName??a.fullName??a.name??(a.employeeCode?String(a.employeeCode):"UNKNOWN"),d=a.department??a.departmentName??"-",e=a.role??a.position??"",f=a.month??a.monthLabel??(null!=a.year&&null!=a.monthNumber?`${a.year} M${String(a.monthNumber).padStart(2,"0")}`:""),g=a.baseSalary??a.salary??0,h=a.overtime??0,i=a.deductions??0,j=a.total??a.totalSalary??g,k=a.advance??0,l=a.remaining??j-k,m=a.status??"",n=a.payoutDate??a.date??a.loggedAt??a.createdAt??"";return{id:String(b),employee:c,department:d,role:e,month:f,baseSalary:g,overtime:h,deductions:i,total:j,advance:k,remaining:l,status:m,payoutDate:n}}let i=[{key:"id",label:"ID",sortable:!0},{key:"employee",label:"Xodim",sortable:!0},{key:"role",label:"Lavozim",sortable:!1},{key:"month",label:"Oyi",sortable:!0},{key:"total",label:"Umumiy oyligi ($)",sortable:!0},{key:"advance",label:"Olgan avansi ($)",sortable:!0},{key:"remaining",label:"Qoldiq ($)",sortable:!0},{key:"status",label:"Status",sortable:!0},{key:"payoutDate",label:"To'lov sanasi",sortable:!0}],j=new Intl.NumberFormat("ru-RU",{style:"currency",currency:"USD",maximumFractionDigits:0}),k=()=>{let a=new Date,b=a.getFullYear(),c=a.getMonth()+1;return`${b} M${String(c).padStart(2,"0")}`},l=new Date,m=l.getFullYear(),n=`${m}-01-01`,o=l.toISOString().slice(0,10);function p(){let[a,l]=(0,c.useState)({dateFrom:n,dateTo:o,status:"all"}),[m,p]=(0,c.useState)([]),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(null),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(null),[A,B]=(0,c.useState)({amount:"",paymentDate:new Date().toISOString().split("T")[0],notes:""}),[C,D]=(0,c.useState)({employee:"",role:"",month:k(),baseSalary:""}),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(null),[K,L]=(0,c.useState)(!1),[M,N]=(0,c.useState)([]),[O,P]=(0,c.useState)([]),[Q,R]=(0,c.useState)([]),[S,T]=(0,c.useState)([]);(0,c.useEffect)(()=>{let b=!1;return(async()=>{r(!0),t(null);try{let c=await (0,g.get)("/payroll",{params:{dateFrom:a.dateFrom||void 0,dateTo:a.dateTo||void 0,status:"all"===a.status?void 0:a.status}});if(b)return;let d=Array.isArray(c)?c:c.items??[];p(d.map(a=>h(a)))}catch(a){if(b)return;a instanceof g.ApiError?t(a.data&&a.data.message||a.message||"Oylik yozuvlarini yuklashda xatolik yuz berdi"):t("Oylik yozuvlarini yuklashda xatolik yuz berdi. Iltimos, qayta urinib ko'ring.")}finally{b||r(!1)}})(),()=>{b=!0}},[a.dateFrom,a.dateTo,a.status]),(0,c.useEffect)(()=>{let a=!1;return(async()=>{try{let[b,c,d]=await Promise.all([(0,g.get)("/payroll/filters"),(0,g.get)("/employees",{params:{department:"",role:"",active:!0}}),(0,g.get)("/employees/filters")]);if(a)return;let e=b.departments??[],f=b.statuses??[];P(e),R(f);let h=Array.isArray(c)?c:c.items??[];N(h);let i=d.roles??[];T(i),D(a=>({...a,role:a.role||i[0]||""}))}catch{}})(),()=>{a=!0}},[]);let U=(0,c.useMemo)(()=>m.filter(b=>{let c,d,e;return("all"===a.status||b.status===a.status)&&(c=new Date(b.payoutDate).getTime(),d=a.dateFrom?new Date(a.dateFrom).getTime():void 0,e=a.dateTo?new Date(a.dateTo).getTime():void 0,("number"!=typeof d||c>=d)&&("number"!=typeof e||c<=e))}),[m,a.status,a.dateFrom,a.dateTo]),V=U.reduce((a,b)=>(a.total+=b.total,a.count+=1,a),{total:0,count:0});V.count&&(V.total,V.count);let W=(0,c.useMemo)(()=>S.map(a=>({value:a,label:a})),[S]);return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-[#0F172A]",children:"Ishchilar oyligi"}),(0,b.jsx)("p",{className:"text-[#64748B] mt-1",children:"Bo'limlar kesimidagi to'lovlar holati"})]}),(0,b.jsxs)("div",{className:"bg-white rounded-lg p-6 card-shadow space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-semibold text-[#0F172A] mb-2 block",children:"Boshlanish sanasi"}),(0,b.jsx)("input",{type:"date",value:a.dateFrom,onChange:a=>l(b=>({...b,dateFrom:a.target.value})),className:"w-full px-3 py-2 border border-[#E2E8F0] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#2563EB]"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-semibold text-[#0F172A] mb-2 block",children:"Tugash sanasi"}),(0,b.jsx)("input",{type:"date",value:a.dateTo,onChange:a=>l(b=>({...b,dateTo:a.target.value})),className:"w-full px-3 py-2 border border-[#E2E8F0] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#2563EB]"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-semibold text-[#0F172A] mb-2 block",children:"Status"}),(0,b.jsx)(f.SelectField,{value:a.status,onChange:a=>l(b=>({...b,status:a})),options:[{value:"all",label:"Barchasi"},...Q.map(a=>({value:a,label:a}))]})]})]}),(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsx)("button",{type:"button",onClick:()=>l({dateFrom:"",dateTo:"",status:"all"}),className:"px-4 py-2 border border-[#E2E8F0] rounded-lg text-sm text-[#0F172A] hover:bg-[#F1F5F9] mt-2",children:"Filtrlarni tozalash"})})]}),(0,b.jsxs)("div",{className:"bg-white rounded-lg p-6 card-shadow",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-[#0F172A]",children:"Ish haqi ro'yxati"}),(0,b.jsxs)("button",{onClick:()=>x(!0),className:"px-4 py-2 bg-[#2563EB] text-white rounded-lg hover:bg-[#1D4ED8] transition-colors font-semibold flex items-center gap-2",children:[(0,b.jsx)("span",{children:"+"}),(0,b.jsx)("span",{children:"Yangi ishchini ishga olish"})]})]}),s&&(0,b.jsx)("p",{className:"mb-4 text-sm text-red-600",children:s}),(0,b.jsx)(d.DataTable,{columns:i,data:U,searchableFields:["id","employee","department","role","status"],renderCell:(a,c)=>{if("total"===c.key||"advance"===c.key)return j.format(a[c.key]);if("remaining"===c.key){let d=a[c.key],e=d<0;return(0,b.jsxs)("span",{className:e?"text-red-600 font-semibold":"",children:[e?"-":"",j.format(Math.abs(d))]})}return a[c.key]},actions:a=>(0,b.jsx)("button",{onClick:()=>{F(null),z(a),B({amount:a.remaining>0?a.remaining.toString():"",paymentDate:new Date().toISOString().split("T")[0],notes:""}),v(!0)},className:"px-3 py-1 bg-[#10B981] text-white rounded-lg hover:bg-[#059669] transition-colors text-sm font-semibold",children:"Oylik berish"}),footerTotals:U.reduce((a,b)=>(a.total+=b.total,a.advance+=b.advance,a.remaining+=b.remaining,a.count+=1,a),{total:0,advance:0,remaining:0,count:0})})]}),(0,b.jsx)(e.Modal,{isOpen:u,title:y?`${y.employee} uchun oylik berish`:"Oylik berish",onClose:()=>{v(!1),z(null),B({amount:"",paymentDate:new Date().toISOString().split("T")[0],notes:""}),F(null),H(!1)},size:"lg",children:y&&(0,b.jsxs)("form",{onSubmit:async a=>{if(a.preventDefault(),!y)return;let b=Number(A.amount);H(!0),F(null);try{let a={amount:b,paymentDate:A.paymentDate,notes:A.notes||void 0},c=await (0,g.post)(`/payroll/${y.id}/pay`,a),d=c.record??c;p(a=>a.map(a=>a.id===d.id?d:a)),v(!1),z(null),B({amount:"",paymentDate:new Date().toISOString().split("T")[0],notes:""})}catch(a){a instanceof g.ApiError?F(a.data&&a.data.message||a.message||"Oylik to'lovini saqlashda xatolik yuz berdi"):F("Oylik to'lovini saqlashda xatolik yuz berdi. Iltimos, qayta urinib ko'ring.")}finally{H(!1)}},className:"space-y-4",children:[(0,b.jsxs)("div",{className:"bg-[#F8FAFC] p-4 rounded-lg space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-sm text-[#64748B]",children:"Xodim:"}),(0,b.jsx)("span",{className:"text-sm font-semibold text-[#0F172A]",children:y.employee})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-sm text-[#64748B]",children:"Bo'lim:"}),(0,b.jsx)("span",{className:"text-sm font-semibold text-[#0F172A]",children:y.department})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-sm text-[#64748B]",children:"Umumiy oyligi:"}),(0,b.jsx)("span",{className:"text-sm font-semibold text-[#0F172A]",children:j.format(y.total)})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-sm text-[#64748B]",children:"Olgan avansi:"}),(0,b.jsx)("span",{className:"text-sm font-semibold text-[#0F172A]",children:j.format(y.advance)})]}),(0,b.jsxs)("div",{className:"flex justify-between border-t border-[#E2E8F0] pt-2",children:[(0,b.jsx)("span",{className:"text-sm font-semibold text-[#0F172A]",children:"Qoldiq:"}),(0,b.jsx)("span",{className:"text-sm font-semibold text-[#10B981]",children:j.format(y.remaining)})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-semibold text-[#0F172A] mb-2 block",children:"To'lov miqdori ($)"}),(0,b.jsx)("input",{type:"number",value:A.amount,onChange:a=>B(b=>({...b,amount:a.target.value})),className:"w-full px-3 py-2 border border-[#E2E8F0] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#2563EB]",placeholder:"0",min:"0",step:"0.01",required:!0}),(0,b.jsxs)("p",{className:"text-xs text-[#64748B] mt-1",children:["Qoldiq: ",j.format(y.remaining),y.remaining<0&&(0,b.jsxs)("span",{className:"text-red-600 ml-2",children:["(Qoldiqdan ko'p berilgan: ",j.format(Math.abs(y.remaining)),")"]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-semibold text-[#0F172A] mb-2 block",children:"To'lov sanasi"}),(0,b.jsx)("input",{type:"date",value:A.paymentDate,onChange:a=>B(b=>({...b,paymentDate:a.target.value})),className:"w-full px-3 py-2 border border-[#E2E8F0] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#2563EB]",required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-semibold text-[#0F172A] mb-2 block",children:"Izoh (ixtiyoriy)"}),(0,b.jsx)("textarea",{value:A.notes,onChange:a=>B(b=>({...b,notes:a.target.value})),className:"w-full px-3 py-2 border border-[#E2E8F0] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#2563EB]",rows:3,placeholder:"Qo'shimcha ma'lumotlar..."})]}),E&&(0,b.jsx)("p",{className:"text-sm text-red-600",children:E}),(0,b.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,b.jsx)("button",{type:"submit",className:"flex-1 px-4 py-2 bg-[#10B981] text-white rounded-lg hover:bg-[#059669] transition-colors font-semibold disabled:opacity-50 disabled:cursor-not-allowed",disabled:G,children:"Oylik berish"}),(0,b.jsx)("button",{type:"button",onClick:()=>{v(!1),z(null),B({amount:"",paymentDate:new Date().toISOString().split("T")[0],notes:""})},className:"flex-1 px-4 py-2 bg-gray-200 text-[#0F172A] rounded-lg hover:bg-gray-300 transition-colors font-semibold",children:"Bekor qilish"})]})]})}),(0,b.jsx)(e.Modal,{isOpen:w,title:"Yangi ishchini ishga olish",onClose:()=>{x(!1),D({employee:"",role:"",month:k(),baseSalary:""}),J(null),L(!1)},size:"lg",children:(0,b.jsxs)("form",{onSubmit:async b=>{b.preventDefault(),L(!0),J(null);try{let b=C.employee.trim();if(!b){J("Xodim ismi kiritilmagan"),L(!1);return}let c=C.month.trim(),d=c.match(/^(\d{4})\s*M(\d{1,2})$/);if(!d){J("Oyi noto'g'ri formatda. Masalan: 2025 M12"),L(!1);return}let e=Number(d[1]),f=Number(d[2]),i={employeeId:0,employeeName:b,employeeRole:C.role||null,year:e,month:f,monthLabel:c,baseSalary:""!==C.baseSalary&&Number(C.baseSalary)||0,overtime:0,deductions:0,advance:0};await (0,g.post)("/payroll",i);try{let b=await (0,g.get)("/payroll",{params:{dateFrom:a.dateFrom,dateTo:a.dateTo,status:"all"===a.status?void 0:a.status}}),c=Array.isArray(b)?b:b.items??[];p(c.map(a=>h(a)))}catch{}x(!1),D({employee:"",role:"",month:k(),baseSalary:""})}catch(a){a instanceof g.ApiError?J(a.data&&a.data.message||a.message||"Yangi ishchini saqlashda xatolik yuz berdi"):J("Yangi ishchini saqlashda xatolik yuz berdi. Iltimos, qayta urinib ko'ring.")}finally{L(!1)}},className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-semibold text-[#0F172A] mb-2 block",children:"Xodim ismi"}),(0,b.jsx)("input",{type:"text",value:C.employee,onChange:a=>D(b=>({...b,employee:a.target.value})),className:"w-full px-3 py-2 border border-[#E2E8F0] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#2563EB]",placeholder:"Xodim ismini kiriting",required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-semibold text-[#0F172A] mb-2 block",children:"Lavozim"}),(0,b.jsx)(f.SelectField,{value:C.role,onChange:a=>D(b=>({...b,role:a})),options:W})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-semibold text-[#0F172A] mb-2 block",children:"Oyi"}),(0,b.jsx)("input",{type:"text",value:C.month,onChange:a=>D(b=>({...b,month:a.target.value})),className:"w-full px-3 py-2 border border-[#E2E8F0] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#2563EB]",placeholder:"Masalan: 2025 M12",required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-semibold text-[#0F172A] mb-2 block",children:"Asosiy oylik ($)"}),(0,b.jsx)("input",{type:"number",value:C.baseSalary,onChange:a=>D(b=>({...b,baseSalary:a.target.value})),className:"w-full px-3 py-2 border border-[#E2E8F0] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#2563EB]",placeholder:"0",min:"0",step:"0.01",required:!0})]}),(0,b.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,b.jsx)("button",{type:"submit",className:"flex-1 px-4 py-2 bg-[#2563EB] text-white rounded-lg hover:bg-[#1D4ED8] transition-colors font-semibold disabled:opacity-50 disabled:cursor-not-allowed",disabled:K,children:"Saqlash"}),(0,b.jsx)("button",{type:"button",onClick:()=>{x(!1),D({employee:"",role:"",month:k(),baseSalary:""}),J(null)},className:"flex-1 px-4 py-2 bg-gray-200 text-[#0F172A] rounded-lg hover:bg-gray-300 transition-colors font-semibold",children:"Bekor qilish"})]}),I&&(0,b.jsx)("p",{className:"text-sm text-red-600",children:I})]})})]})}a.s(["default",()=>p])}];

//# sourceMappingURL=app_owner-dashboard_payroll_page_tsx_73c21e36._.js.map